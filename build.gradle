buildscript {
    repositories {
        jcenter()
        mavenCentral()
    }
}

group 'io.polygloat'
apply plugin: 'idea'

idea {
    module {
        excludeDirs += file('node_modules')
        excludeDirs += file('packages/core/node_modules')
        excludeDirs += file('packages/core/dist')
        excludeDirs += file('packages/core/lib')
        excludeDirs += file('packages/ui/node_modules')
        excludeDirs += file('packages/ui/dist')
        excludeDirs += file('packages/ui/lib')
        excludeDirs += file('e2e/cypress/testapps/dist')
        excludeDirs += file('e2e/cypress/videos')
    }
}

apply from: "./gradle/e2e.gradle"

task lernaBootstrap(type: Exec) {
    commandLine "lerna", "bootstrap"
}

task buildCore(type: Exec) {
    dependsOn "lernaBootstrap"
    commandLine "npm", "run", "build"
    workingDir "packages/core"
}

task buildReact(type: Exec) {
    dependsOn "lernaBootstrap"
    commandLine "npm", "run", "build"
    workingDir "packages/react"
    mustRunAfter "buildCore", "buildUi"
}

task buildNgx(type: Exec) {
    dependsOn "lernaBootstrap"
    commandLine "npm", "run", "build"
    workingDir "packages/ngx"
    mustRunAfter "buildCore", "buildUi"
}

task buildUi(type: Exec) {
    dependsOn "lernaBootstrap"
    commandLine "npm", "run", "build"
    workingDir "packages/core"
}

task buildAll(type: Task) {
    dependsOn "buildCore", "buildUi", "buildReact", "buildNgx"
}

task developAll(type: Exec) {
    dependsOn "lernaBootstrap", "buildAll"
    commandLine "lerna", "exec", "--parallel", "--", "npm", "run", "develop"
}

task testCore(type: Exec) {
    commandLine "npm", "run", "test"
    workingDir "packages/core"
}

task testReact(type: Exec) {
    commandLine "npm", "run", "test"
    workingDir "packages/react"
}

task testUi(type: Exec) {
    commandLine "npm", "run", "test"
    workingDir "packages/ui"
}

task build(type: Task) {
    dependsOn "buildAll", "testUi", "testCore", "testReact", "runE2e"
}