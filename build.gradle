plugins {
    id("com.github.node-gradle.node") version "2.2.0"
}

def npmTask(taskName, workingDir, commandArgs, group) {
    task(taskName, type: NpmTask, group: group) {
        doFirst {
            this.project.node.nodeModulesDir = file(workingDir)
        }
        description = "Installs all dependencies from package.json"
        workingDir = file(workingDir)
        args = commandArgs
        inputs.files("${workingDir}/package.json", "${workingDir}/package-lock.json")
        outputs.dir("${workingDir}/node_modules")
    }
}

npmTask("polygloatJsNpmInstall", project.projectDir, ["install"], "Polygloat Js - Core")

npmTask("polygloatJsDevelop", project.projectDir, ["run", "develop", "--watch"], "Polygloat Js - Core")

idea {
    module {
        excludeDirs += file('node_modules')
        excludeDirs += file('dist')
        excludeDirs += file('lib')
    }
}